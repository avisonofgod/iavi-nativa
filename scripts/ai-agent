#!/bin/bash

GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

clear

echo -e "${BLUE}"
cat << 'EOF'
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                    ‚ïë
‚ïë          ü§ñ  AI AGENT - Sin Restricciones          ‚ïë
‚ïë          Powered by Open Interpreter               ‚ïë
‚ïë                                                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
echo -e "${NC}"

# Verificar Ollama
if ! systemctl is-active --quiet ollama; then
    echo -e "${RED}‚ùå Ollama no est√° corriendo${NC}"
    echo "Iniciando Ollama..."
    systemctl start ollama
    sleep 3
fi

# Seleccionar modelo seg√∫n RAM
RAM_AVAILABLE=$(free -g | awk '/^Mem:/{print $7}')
if [ "$RAM_AVAILABLE" -gt 20 ]; then
    MODEL="ollama/nous-hermes2-mixtral:8x7b-dpo-q4_K_M"
    MODEL_NAME="Mixtral 8x7B (Potente)"
else
    MODEL="ollama/llama3.2:3b"
    MODEL_NAME="Llama 3.2 3B (Optimizado)"
fi

echo -e "${GREEN}‚úÖ Sistema listo${NC}"
echo -e "üì° Modelo: ${YELLOW}${MODEL_NAME}${NC}"
echo -e "üîì Modo: ${YELLOW}Owner (sin restricciones)${NC}"
echo -e "‚ö° Auto-run: ${YELLOW}Activado${NC}"
echo ""
echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo ""
echo -e "${GREEN}Capacidades disponibles:${NC}"
echo "  ‚úì Ejecutar comandos shell (como root)"
echo "  ‚úì Editar archivos del sistema"
echo "  ‚úì Instalar y configurar software"
echo "  ‚úì Programar en Python, PHP, JavaScript, etc"
echo "  ‚úì Corregir bugs y optimizar c√≥digo"
echo "  ‚úì Gestionar bases de datos"
echo "  ‚úì Configurar servicios (nginx, freeradius, docker)"
echo ""
echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo ""
echo -e "${YELLOW}Comandos especiales:${NC}"
echo "  ${GREEN}exit / Ctrl+C${NC}  - Salir del agente"
echo "  ${GREEN}reset${NC}          - Reiniciar conversaci√≥n"
echo ""
echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo ""
echo -e "${GREEN}üí° Tip: S√© espec√≠fico en tus peticiones para mejores resultados${NC}"
echo ""

# Verificar si hay un TTY disponible
if [ -t 0 ]; then
    # Modo interactivo
    python3 -u << EOFPYTHON
import sys
from interpreter import interpreter

# Configuraci√≥n
interpreter.offline = True
interpreter.auto_run = True
interpreter.llm.model = "${MODEL}"
interpreter.llm.api_base = "http://localhost:11434"
interpreter.llm.temperature = 0.7
interpreter.llm.context_window = 4096
interpreter.llm.max_tokens = 2048

interpreter.system_message = """Eres un agente AI aut√≥nomo con acceso TOTAL al sistema Linux.

CONFIGURACI√ìN:
- Usuario: root
- Modo: OWNER (sin restricciones)
- Auto-aprobaci√≥n: ACTIVADA

COMPORTAMIENTO:
- Ejecutas TODO sin confirmaci√≥n
- Resuelves problemas autom√°ticamente
- Eres directo y eficiente

CAPACIDADES:
- Shell, archivos, software, servicios
- Python, PHP, JavaScript, bash
- MySQL, PostgreSQL, Docker, Nginx"""

try:
    interpreter.chat()
except (EOFError, KeyboardInterrupt):
    print("\n\nüëã Saliendo del agente...")
    sys.exit(0)
EOFPYTHON
else
    # Sin TTY - mostrar mensaje
    echo -e "${RED}‚ö†Ô∏è  No se detect√≥ un terminal interactivo${NC}"
    echo ""
    echo "Para usar el agente en modo interactivo, con√©ctate con:"
    echo "  ${GREEN}ssh -t root@<servidor>${NC}"
    echo ""
    echo "O ejecuta directamente:"
    echo "  ${GREEN}python3 -c 'from interpreter import interpreter; interpreter.offline=True; interpreter.auto_run=True; interpreter.llm.model=\"${MODEL}\"; interpreter.chat(\"tu petici√≥n aqu√≠\")'${NC}"
    exit 1
fi
